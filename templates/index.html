<!DOCTYPE html>
<html>
  <head>
    <title>GPX Viewer</title>
    <script src="https://unpkg.com/htmx.org"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCryDw2Y_ikiLWtUmegahAgmlspm2X7Uyw&callback=initMap&libraries=drawing&v=weekly" defer></script>
    <style>
        /* Full-screen map and body styling */
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        /* Overlay text styling */
        #overlayText {
            position: absolute; /* Position absolutely */
            top: 10px; /* Distance from the top */
            left: 10px; /* Distance from the left */
            background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent white background */
            padding: 5px; /* Some padding */
            z-index: 100; /* Ensure it's above the map */
            border-radius: 5px; /* Optional: rounded corners */
            /* Additional styling */
            font-family: Arial, sans-serif; /* Font family */
            font-size: 1.2em; /* Font size */
            box-shadow: 0 2px 4px rgba(0,0,0,0.3); /* Box shadow for a subtle 'raised' effect */
            max-width: 300px; /* Maximum width to prevent it from stretching too wide */
        }
        /* Ensure the H3 element has similar styling if intended to be an overlay */
        h1.overlayText {
            position: absolute;
            top: 20px;
            left: 40px;
            color: white; /* Text color */
            text-shadow: 1px 1px 2px black; /* Text shadow for better readability */
        }
    </style>
    <script>
       function initMap() {    
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 3,
                center: { lat: 0, lng: -180 },
                mapTypeId: "satellite",
                disableDefaultUI: true,
            });
                      
            fetch('gpx_test')
                .then(response => response.text())
                .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
                //.then(data => console.log(data))
                .then(doc =>
                {
                    var points = [];
                    var bounds = new google.maps.LatLngBounds();
                
                    const nodes = [...doc.getElementsByTagName('trkpt')];
                    nodes.forEach(node =>
                    {
                        var lat = node.getAttribute("lat");
                        var lon = node.getAttribute("lon");
                        //console.log(lat);
                        
                        var p = new google.maps.LatLng(lat, lon);
                        points.push(p);
                        bounds.extend(p);
                    })
                    
                    var poly = new google.maps.Polyline({
                             path: points,
                             strokeColor: "#0000FF",
                             strokeOpacity: 1,
                             strokeWeight: 4
                        });
                        poly.setMap(map);
                        // fit bounds to track
                        map.fitBounds(bounds);
                })
        }
    </script>
  </head>
  <body>
    <!-- Optional: If you want the h3 to be an overlay as well -->
    <div class="overlayText">
        <h1>My Google Maps Demo</h1>
        <form hx-post="127.0.0.1:39724/Upload" hx-enc-type="multipart/form-data" hx-target="#result" hx-swap="outerHTML">
            <input type="file" name="file" accept=".gpx"/>
            <button type="submit">Upload</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="map"></div>
  </body>
</html>
